<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Automatically generate Team Fortress 2 configs, including custom VPKs, tweaks, crosshair switcher and more. Get a good fps boost without stupid unnecessary stuff." />
    <title>CFG.TF - Setting up a TF2 server</title>

		<!-- Latest compiled and minified CSS -->
		<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css"> -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" integrity="sha256-r1WijW/SNMgOwk5LDk7QRHr6oVYYbYWMw/1kOXfYJfg=" crossorigin="anonymous" />
		<!-- Latest compiled and minified JavaScript -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>
		<!-- Extras -->
		<!-- fontawesome --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

    <link rel="stylesheet" href="../../css/pygments.css">
    <link rel="stylesheet" href="../../css/main.css">
		<script type="text/javascript" src="../../js/utility.js"></script>
  </head>
  <body>

		<div class="jumbotron" id="overlay">
			<div id="overlay_middle">
				<div id="overlay_inner">
					<div id="loading_logo">
						<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 464 462.9">
							<path fill="#000" d="M213 19.2A213 213 0 0 0 19.7 212H160a74.4 74.4 0 0 1 53-52.6V19.2zm38 0v140.4a74.4 74.4 0 0 1 52.4 52.3h140.4A213 213 0 0 0 251 19zM19.5 250A213 213 0 0 0 213 443.4V303.2a74.4 74.4 0 0 1-53.3-53.3H19.5zm284 0a74.4 74.4 0 0 1-52.5 53v140.4A213 213 0 0 0 443.8 250H303.6z"/>
						</svg>
			  	</div>
					<noscript><style>#overlay {display: none;}</style></noscript>
				</div>
			</div>
		</div>

  <nav class="navbar navbar-default" role="navigation">
		<div class="container">
			<div class="navbar-header">
				<a class="navbar-brand" href="../../"><i class="fa fa-cogs" aria-hidden="true"></i> CFG.TF</a>
			</div>
			<ul class="nav navbar-nav">
				<li>
					<a href="../../make">Generate</a>
				</li>
				<li>
					<a href="../../server">Server config</a>
				</li>
				<li class="dropdown active">
				  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Articles<span class="caret"></span></a>
				  <ul class="dropdown-menu" role="menu">
					<li><a href="../../read/interp">Networking in Source games</a></li>
					<li><a href="../../read/health">Health care</a></li>
					<li class="active"><a href="../../read/server">Set up a TF2 server</a></li>
					<li><a href="https://steamcommunity.com/sharedfiles/filedetails/?id=154435696" target="_blank"><i class="fa fa-external-link"></i>  Scripting guide</a></li>
				  </ul>
				</li>
				<li>
					<a href="../../configs">Configs</a>
				</li>
				<li class="dropdown">
				  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Tools<span class="caret"></span></a>
				<ul class="dropdown-menu" role="menu">
					<li><a href="../../tools/bindgen">Bind rotation generator</a></li>
					<li><a href="../../tools/asci">ASCI art maker</a></li>
				  </ul>
				  </li>
			</ul>

			<ul class="nav navbar-nav navbar-right">
				<li>
					<a href="../../faq/">FAQ</a>
				</li>
				<li>
					<a href="../../about/">About</a>
				</li>
				<li>
					<a href="https://blog.cfg.tf">Blog</a>
				</li>
			</ul>
		</div>
	</nav>
  <div id="wrapper" class="container">
  <br>
  <h2>Setting up a TF2 server</h2>
  <p>Learn how to simply manage a TF2 server on Linux VPS or a local server with this very fine guide by <a href="http://steamcommunity.com/id/burningsmile/" target="_blank">BurningSmile</a>. You can also open text instructions below.</p>
  <br>
  <div class="panel panel-default">
  <div class="panel-body">
    	<div class="embed-responsive embed-responsive-16by9">
	  <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/nyMyCPI5LP4"></iframe>
	</div>
  </div>
</div>
<div class="panel panel-default">
        <div class="panel-heading">
          <button type="button" class="btn btn-default btn-xs spoiler-trigger" data-toggle="collapse">Show instructions</button>
        </div>
        <div class="panel-collapse collapse out">
          <div class="panel-body">
            <p><a href="https://www.metamodsource.net/downloads.php?branch=stable" target="_blank">Metamod</a> | <a href="https://www.sourcemod.net/downloads.php?branch=stable" target="_blank">Sourcemod</a> | <a href="https://gameservermanagers.com/lgsm/tf2server/" target="_blank">LGSM</a></p>
<p>Command used in Video are as follows:<br><br>

Updating:
<br>
<code>apt update</code><br>
<code>apt upgrade</code><br>
<code>apt dist-upgrade</code><br>
<code>apt autoremove</code><br>
<code>apt clean</code><br>
</p>

<p>Turn off auto updates
<br>
<code>vim /etc/apt/apt.conf.d/10periodic</code><br>
Change 1 to 0<br>
Save and exit file<br>
<br>
Dependencies for LGSM<br>
<br>
<br>
Ubuntu <br>
<code>dpkg --add-architecture i386; apt-get update; apt-get install mailutils postfix curl wget file bzip2 gzip unzip bsdmainutils python util-linux tmux lib32gcc1 libstdc++6 libstdc++6:i386 libcurl4-gnutls-dev:i386</code><br>
<br>
Debian<br>
<code>dpkg --add-architecture i386; sudo apt-get update; sudo apt-get install mailutils postfix curl wget file bzip2 gzip unzip bsdmainutils python util-linux tmux lib32gcc1 libstdc++6 libstdc++6:i386 libcurl4-gnutls-dev:i386</code><br>
Fedora<br>
<code>dnf install mailx postfix curl wget file bzip2 gzip unzippython tmux glibc.i686 libstdc++ libstdc++.i686 libcurl.i686</code><br>
<br>
Centos<br>
<code>yum install mailx postfix curl wget bzip2 gzip unzip python tmux glibc.i686 libstdc++ libstdc++.i686 libcurl.i686</code><br>
<br>
Create a tf2server account<br>
<code>adduser tf2server</code><br>
<br>
Create a password for the account<br>
<code>Passwd tf2server</code><br>
<br>
Change to the account<br>
<code>su - tf2server</code><br>
<br>
Download the tf2 server management stack<br>
<code>wget https://gameservermanagers.com/dl/tf2server</code><br>
<br>
Enable execution rights on the file<br>
<code>chmod +x tf2server</code><br>
<br>
Install the server<br>
<code>./tf2server install</code><br>
<br>
Edit tf2 server launch settings<br>
<code>vim tf2server </code><br>
Change server slots<br>
Change update on start<br>
Save the file<br>
<br>
Allow tf2server through the firewall.<br>
<br>
<b>Replace venet0 with your network interface. You can find this from the output of ip link show. Use the interface that is NOT 'lo'</b>
<code>
iptables -A INPUT -i venet0 -p tcp -m tcp --dport 27015 -m state --state NEW,ESTABLISHED -j ACCEPT <br>
iptables -A INPUT -i venet0 -p udp -m udp --dport 27015 -m state --state NEW,ESTABLISHED -j ACCEPT <br>
iptables -A INPUT -i venet0 -p tcp -m tcp --dport 27020 -m state --state NEW,ESTABLISHED -j ACCEPT <br>
iptables -A INPUT -i venet0 -p udp -m udp --dport 27020 -m state --state NEW,ESTABLISHED -j ACCEPT <br>
iptables-save > /etc/iptables/rules.v4 <br>
ip6tables-save > /etc/iptables/rules.v6 <br>
</code>

<br>
Start the server<br>
<code>./tf2server start</code><br>
<br>
Test connecting to it<br>
Connect ip-here in game console<br>
<br>
Stop the server<br>
<code>./tf2server stop</code><br>
<br>
Installing apache2 webserver<br>
<code>exit</code><br> 
<code>apt install apache2</code><br>
<code>
	mkdir -p /var/www/html/fastdl/tf2/ <br>
	cd /var/www/html/fastdl/tf2/ <br>
	ln -s /home/tf2server/serverfiles/tf/maps maps <br>
	ls -la <br>
	systemctl status apache2.service <br>
	systemctl start apache2.service <br>
	systemctl enable apache2.service <br>
	Cd ../.. <br>
mv index.html index.html.bak</code><br>
<br>
Refresh the page and test downloading a map<br>
<br>
Address sftp:// ip here<br>
User tf2server<br>
Password The password you set up on the tf2 server account<br>
Port 22<br>
<br>
Change FileZilla directory to serverfiles/tf<br>
<br>
Back in the ssh session<br>
<code>Su - tf2server </code><br>
<code>cd serverfiles/tf/ </code><br>
<br>
Now for metamod. <br>
Go to the site and copy its link address for the Linux version.<br>
https://www.metamodsource.net/downloads.php?branch=stable<br>
<code>Wget (link here)</code> <br>
<code>Tar -xvf mmsource </code> (Use tab completion)<br>
<code>Rm mmsource </code> (tab complete)<br>
<br>
Now for sourcemod<br>
Go to the souremod site and copy its link address for the Linux version<br>
https://www.sourcemod.net/downloads.php?branch=stable<br>
<code>Wget (link here) </code><br>
<code>Tar -xvf sourcemod </code> (tab complete)<br>
<code>Rm sourcemod </code><br>( tab complete)<br>
<br>
Setting up admin account<br>
<code>vim ./addons/souremod/config/admins_simple.ini </code><br>
<br>
Go to a <a href="http://steamidfinder.com/" target="_blank">steamidfinder.com</a><br>
Paste your steam url and paste the steam id. Follow the below example<br>
<code>“STEAMID” “99:z” //useraccountname </code><br>
<br>
Go to cfg.tf and follow my example for configuring the server.<br>
<br>
Custom settings used in video. Remember to replace IP-GOES-HERE with the ip of your vps.<br>
<code>
	// Server downloads and files<br>
	net_maxfilesize "64" <br>
	sv_downloadurl "http://IP-GOES-HERE/fastdl/tf2/" <br>
	sv_allowdownload "1" <br>
	sv_allowupload "1" <br>
sv_consistency "1"</code><br>
<br>
Unzip the file and upload it to your server in sftp to your serverfiles/tf directory, overwrite any files if asked.<br>
<br>
Start the server via ssh<br>
<code>./tf2server start </code><br>
<br>
Automate a restart at midnight. And automate the SRCDS instance starting on server start and restart.<br>
Refer to crontab documentation if needed. <br>
https://linux.die.net/man/5/crontab<br>
https://help.ubuntu.com/community/CronHowto<br>
https://hastebin.com/divuqexeri.rb<br>
<br>
<code>crontab -e </code><br>
Choose 3 to use vim <br>
Add the following in insert mode<br>
<br>
<code>0 0 * * * /home/tf2server/./tf2server restart </code><br> 
<code>@reboot /home/tf2server/./tf2server start</code><br>
<br>
Save the file and exit vim<br>
<br>
Ensure the crontab file works<br>
<code>./tf2server stop</code><br>
<code>Exit</code><br>
<code>Reboot </code><br>
<br>
After the reboot make sure your Srcds instance starts on boot.</p>
          </div>
        </div>
      </div>
	
<script>
	$(".spoiler-trigger").click(function() {
		$(this).parent().next().collapse('toggle');
	});
</script>

  </div>

  <footer class="footer container-fluid">

      <div class="col-md-4 text-center">
        <ul class="list-unstyled">
            <li><a href="//discord.gg/79cbsTu" target="_blank">Join our Discord</a></li>
            <li><a href="//www.teamfortress.tv/40869/cfg-tf" target="_blank">Discuss on TFTV</a></li>
            <li><a href="//github.com/mkrl/cfgtf/issues" target="_blank">Report an issue</a></li>
            <li><a href="//github.com/mkrl/cfgtf" target="_blank">View the source code</a></li>
        </ul>
      </div>

      <div class="col-md-4 text-center">
        <p>CFG.TF</p>
        <p><small>a custom TF2 config generator by <a href="https://steamcommunity.com/id/2x100/" target="_blank">200</a></small></p>
        <script>
          (function(i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function() {
              (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
              m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
          })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
          ga('create', 'UA-97817107-1', 'auto');
          ga('send', 'pageview');
        </script>
      </div>

      <div class="col-md-4">
        <p class="text-center">~
          <script language="JavaScript">
            var fhsh = document.createElement('script');
            var fhs_id_h = "3234623";
            fhsh.src = "//s1.freehostedscripts.net/ocount.php?site=" + fhs_id_h + "&name=configs&a=1";
            document.head.appendChild(fhsh);
            document.write("<span id='h_" + fhs_id_h + "'></span>");
          </script> generated so far.
        </p>
      </div>

  </footer>

  </body>
</html>
